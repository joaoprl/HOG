
import java.awt.color.ColorSpace;
import java.awt.image.BufferedImage;
import java.awt.image.ColorConvertOp;
import java.io.File;
import java.io.IOException;
import javax.imageio.ImageIO;

public class Hog {
	private BufferedImage image = null;

	public Hog(String file){
		BufferedImage colorImage = null;
		try {
			colorImage = ImageIO.read(new File(file));
		} catch (IOException e) {
			e.printStackTrace();
		}
		ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);  
		ColorConvertOp op = new ColorConvertOp(cs, null);  
		image = op.filter(colorImage, null);

	}
	
	public double[][][] getHistograms(){
		double [][][] histograms = new double[image.getWidth()][image.getHeight()][9];
		
		Thread t = new Thread(new HogGradients(this, histograms));
		t.start();
		try {
			t.join();
		} catch (InterruptedException e) {
			e.printStackTrace();
		}
		
		/*
		for(int x = 0; x < image.getWidth(); x++){				
			for(int y = 0; y < image.getHeight(); y++){
				for(int z = 0; z < 9; z++)
					if(histograms[x][y][z] > 5)
						System.out.print(histograms[x][y][z] + "\n");
			}
		}
		*/
		return histograms;
	}

	public double[][][] getOutput(double[][][] histograms){
		double output[][][] = new double[image.getWidth() - 1][image.getHeight() - 1][36];
		for(int x = 0; x < image.getWidth() / 8 - 1; x++){

			for(int y = 0; y < image.getHeight() / 8 - 1; y++){
				int counter = 0;
				double mag = 0;
				for(int a = 0; a < 2; a++){
					for(int b = 0; b < 2; b++){
						for(int z = 0; z < 9; z++){
							output[x][y][counter] = histograms[x + a][y + b][z];
							mag += output[x][y][counter];
							counter++;				        				
						}
					}
				}

				if(mag != 0){
					for(int z = 0; z < 36; z++){
						output[x][y][z] /= mag;
					}
				}
			}
		}
		
		
		for(int x = 0; x < image.getWidth() / 8 -1; x++){
			for(int y = 0; y < image.getHeight() / 8 -1; y++){
				for(int z = 0; z < 36; z++)
						System.out.print(output[x][y][z] + " ");
				System.out.print("\n");
			}
		}
		return output;

	}

	public int getValue(int x, int y){
		return image.getRGB(x, y) & 0xFF;
	}
	
	public int getWidth(){
		return image.getWidth();
	}
	public int getHeight(){
		return image.getHeight();
	}

}
